<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Smart-retail-test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    
    <div class="banner">
      <img src="assets/1738.jpg" alt="banner image">
    </div>
    <div class="form-container">
      <form id="register-form">
        <input type="hidden" name="coupon-id" value="569">
        <label for="country-code">Country code:</label>
        <select id="country-code" name="country-code">
          <option value="65">Singapore(+65)</option>
          <option value="852">Hong Kong (+852)</option>
          <option value="81">Japan (+81)</option>
          <option value="60">Malaysia (+60)</option>
        </select>
        <label for="phone-number">Phone number:</label>
        <input type="text" id="phone-number" name="phone-number" placeholder="Enter phone number">
        <input id="submitButton" type="submit" value="Submit">
      </form>
      <div id="response-message"></div>
    </div>
    <script>
      const form = document.getElementById('register-form')
      const responseMessage = document.getElementById('response-message')
      const chanelId = '@384eqggz';

      const params = new URLSearchParams(window.location.search);
      const countryCode = params.get('country-code');
      const couponId = params.get('coupon-id');
      const phoneNumber = params.get('phone-number');
      const userStatus = params.get('user-status');

      if (userStatus == 'not_registered') {
        responseMessage.textContent = "You have not registered yet!, please click submit to connect and get your coupon";
        responseMessage.style.color = "blue";
      }
      if (userStatus == 'coupon_submitted') {
        //hide form
        form.style.display = "none";
        responseMessage.textContent = "coupon has been submitted please check your line app for the coupon status";
        responseMessage.style.color = "green";
      }

      if (countryCode && phoneNumber) {
        const form = document.getElementById('register-form')
        form.elements['country-code'].value = countryCode;
        form.elements['phone-number'].value = phoneNumber;
      }

      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        //concatenate country code and phone number
        const countryCode = document.getElementById('country-code').value;
        const phoneNumber = document.getElementById('phone-number').value;
        const fullPhoneNumber = countryCode + phoneNumber;

        const redirectURL = 'https://line.me/R/oaMessage/' + chanelId + '/?Kindly%20"PRESS"%20send%20to%20register%20your%20Device%0A%5BPhoneNum:' + fullPhoneNumber + ',%0AMode:Register%5D';

        window.location.href = redirectURL;
      }
      )
    </script>

  </body>
</html>
